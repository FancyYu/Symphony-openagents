# Symphony MVP - åä½œåœºæ™¯ä¸åˆ›æ–°ç‚¹

## ğŸ¯ æ ¸å¿ƒåä½œåœºæ™¯

### åœºæ™¯ï¼šä¸ªäººæˆé•¿æ™ºèƒ½åˆ†æä¸è¡ŒåŠ¨è§„åˆ’

**ç”¨æˆ·æ•…äº‹**ï¼š

> ç”¨æˆ·åœ¨å·¥ä½œä¸­é‡åˆ°å‹åŠ›å’Œå›°æƒ‘ï¼Œå‘ Symphony ç³»ç»Ÿå¯»æ±‚å¸®åŠ©ã€‚ç³»ç»Ÿé€šè¿‡å¤š Agent åä½œï¼Œæä¾›æ·±åº¦å¿ƒç†åˆ†æå’Œä¸ªæ€§åŒ–è¡ŒåŠ¨è®¡åˆ’ã€‚

**å‚ä¸è§’è‰²**ï¼š

- ğŸ‘¤ **ç”¨æˆ·** - å¯»æ±‚å¸®åŠ©çš„ä¸ªäºº
- ğŸ¯ **Coordinator Agent** - åè°ƒè€…ï¼Œç†è§£éœ€æ±‚å¹¶ç¼–æ’æµç¨‹
- ğŸ”¬ **Analyst Agent** - åˆ†æå¸ˆï¼Œæ‰§è¡Œæ·±åº¦å¿ƒç†åˆ†æ
- ğŸ¨ **Creator Agent** - åˆ›ä½œè€…ï¼Œç”Ÿæˆè¡ŒåŠ¨è®¡åˆ’
- ğŸ’¾ **Storage System** - è®°å¿†ç³»ç»Ÿï¼Œæä¾›ä¸Šä¸‹æ–‡

---

## ğŸš€ åˆ›æ–°ç‚¹è¯¦è§£

### 1. æ™ºèƒ½ä»»åŠ¡åˆ†é…æœºåˆ¶ â­â­â­â­â­

#### ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜

```
ç”¨æˆ· â†’ å•ä¸€ AI â†’ é€šç”¨å›å¤
- ç¼ºä¹æ·±åº¦
- æ²¡æœ‰ä¸“ä¸šåˆ†å·¥
- æ— æ³•å¤„ç†å¤æ‚åœºæ™¯
```

#### æˆ‘ä»¬çš„åˆ›æ–°ï¼š**ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„åŠ¨æ€ä»»åŠ¡åˆ†é…**

```python
# coordinator_collaborator.py
def _needs_analysis(self, content: str) -> bool:
    """æ™ºèƒ½åˆ¤æ–­æ˜¯å¦éœ€è¦æ·±åº¦åˆ†æ"""
    analysis_keywords = [
        "åˆ†æ", "å‹åŠ›", "ç„¦è™‘", "å›°æƒ‘", "é—®é¢˜",
        "å»ºè®®", "å¸®åŠ©", "èŒä¸š", "å·¥ä½œ", "å…³ç³»", "æˆé•¿"
    ]

    content_lower = content.lower()
    return any(keyword in content_lower for keyword in analysis_keywords)

async def on_channel_post(self, msg):
    if self._needs_analysis(msg.text):
        # ğŸ”¥ åˆ›æ–°ï¼šåŠ¨æ€å†³ç­–æ˜¯å¦éœ€è¦æ·±åº¦åˆ†æ
        await self.handle_analysis_request(...)
    else:
        # ç®€å•å¯¹è¯ï¼Œç›´æ¥å›å¤
        response = await self.run_agent(...)
```

**åˆ›æ–°ç‚¹**ï¼š

- âœ… **è‡ªåŠ¨è¯†åˆ«å¤æ‚åº¦**ï¼šæ ¹æ®å…³é”®è¯å’Œè¯­ä¹‰åˆ¤æ–­ä»»åŠ¡ç±»å‹
- âœ… **åŠ¨æ€è·¯ç”±**ï¼šç®€å•é—®é¢˜å¿«é€Ÿå“åº”ï¼Œå¤æ‚é—®é¢˜æ·±åº¦åˆ†æ
- âœ… **èµ„æºä¼˜åŒ–**ï¼šé¿å…ä¸å¿…è¦çš„å¤š Agent è°ƒç”¨ï¼ŒèŠ‚çœ API æˆæœ¬
- âœ… **ç”¨æˆ·ä½“éªŒ**ï¼šå¿«é€Ÿå“åº”ç®€å•é—®é¢˜ï¼Œæ·±åº¦å¤„ç†å¤æ‚é—®é¢˜

**å¯¹æ¯”**ï¼š
| ç»´åº¦ | ä¼ ç»Ÿæ–¹å¼ | æˆ‘ä»¬çš„åˆ›æ–° |
|------|---------|-----------|
| ä»»åŠ¡è¯†åˆ« | å›ºå®šè§„åˆ™ | æ™ºèƒ½è¯­ä¹‰åˆ†æ |
| è·¯ç”±ç­–ç•¥ | é™æ€é…ç½® | åŠ¨æ€å†³ç­– |
| å“åº”æ—¶é—´ | ç»Ÿä¸€æ…¢ | åˆ†çº§å“åº” |
| èµ„æºåˆ©ç”¨ | æµªè´¹ | ä¼˜åŒ– |

---

### 2. æ¡†æ¶é©±åŠ¨çš„ä¸“ä¸šåˆ†æ â­â­â­â­â­

#### ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜

```
AI åˆ†æ â†’ é€šç”¨å»ºè®®
- ç¼ºä¹ç†è®ºåŸºç¡€
- ä¸å¤Ÿä¸“ä¸š
- éš¾ä»¥é‡åŒ–
```

#### æˆ‘ä»¬çš„åˆ›æ–°ï¼š**å¤šæ¡†æ¶æ™ºèƒ½é€‰æ‹©ä¸åº”ç”¨**

```python
# coordinator_collaborator.py
def _detect_framework(self, content: str) -> str:
    """ğŸ”¥ åˆ›æ–°ï¼šæ ¹æ®å†…å®¹è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„åˆ†ææ¡†æ¶"""
    content_lower = content.lower()

    if "mbti" in content_lower or "æ€§æ ¼" in content_lower:
        return "MBTI"
    elif "big five" in content_lower or "äº”å¤§äººæ ¼" in content_lower:
        return "Big Five"
    elif "human" in content_lower or "æ½œèƒ½" in content_lower:
        return "HUMAN 3.0"
    else:
        return "general"

# analyst_collaborator.py
async def perform_analysis(self, content, framework_name, user_id):
    """ä½¿ç”¨é€‰å®šçš„æ¡†æ¶è¿›è¡Œä¸“ä¸šåˆ†æ"""
    framework = framework_library.get_framework(framework_name)

    prompt = f"""
    ä½¿ç”¨ {framework.name} æ¡†æ¶åˆ†æï¼š

    æ¡†æ¶ç»´åº¦ï¼š
    {framework.dimensions}

    åˆ†ææŒ‡å—ï¼š
    {framework.analysis_prompt}

    ç”¨æˆ·å†…å®¹ï¼š{content}
    """
```

**åˆ›æ–°ç‚¹**ï¼š

- âœ… **æ¡†æ¶åº“ç³»ç»Ÿ**ï¼šé¢„ç½®å¤šç§å¿ƒç†å­¦å’Œæˆé•¿æ¡†æ¶ï¼ˆMBTI, Big Five, HUMAN 3.0ï¼‰
- âœ… **æ™ºèƒ½æ¡†æ¶é€‰æ‹©**ï¼šæ ¹æ®ç”¨æˆ·é—®é¢˜è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„æ¡†æ¶
- âœ… **ä¸“ä¸šæ€§ä¿è¯**ï¼šåŸºäºæˆç†Ÿçš„å¿ƒç†å­¦ç†è®ºï¼Œä¸æ˜¯éšæ„å»ºè®®
- âœ… **å¯æ‰©å±•æ€§**ï¼šæ˜“äºæ·»åŠ æ–°çš„åˆ†ææ¡†æ¶

**æ¡†æ¶åº“æ¶æ„**ï¼š

```python
# storage/framework_library.py
class Framework:
    name: str
    description: str
    dimensions: List[str]
    analysis_prompt: str

frameworks = {
    "MBTI": Framework(...),
    "Big Five": Framework(...),
    "HUMAN 3.0": Framework(...),
    "Career Development": Framework(...),
    "General": Framework(...)
}
```

---

### 3. è®°å¿†é©±åŠ¨çš„ä¸Šä¸‹æ–‡æ„ŸçŸ¥ â­â­â­â­â­

#### ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜

```
æ¯æ¬¡å¯¹è¯ â†’ ç‹¬ç«‹å¤„ç† â†’ æ— è®°å¿†
- é‡å¤è¯¢é—®
- ç¼ºä¹è¿ç»­æ€§
- æ— æ³•ä¸ªæ€§åŒ–
```

#### æˆ‘ä»¬çš„åˆ›æ–°ï¼š**Memory Palace è®°å¿†æ®¿å ‚ç³»ç»Ÿ**

```python
# storage/memory_palace.py
class MemoryPalace:
    """ğŸ”¥ åˆ›æ–°ï¼šåŒå±‚è®°å¿†ç³»ç»Ÿ"""

    def add_short_term_memory(self, user_id, content, ttl=3600):
        """çŸ­æœŸè®°å¿†ï¼šæœ€è¿‘çš„å¯¹è¯å’ŒçŠ¶æ€"""
        # 1å°æ—¶å†…çš„ä¸´æ—¶è®°å¿†

    def add_long_term_memory(self, user_id, content, keywords, importance):
        """é•¿æœŸè®°å¿†ï¼šé‡è¦çš„æ´å¯Ÿå’Œæ¨¡å¼"""
        # æŒä¹…åŒ–çš„å…³é”®ä¿¡æ¯

    def build_context(self, user_id, current_topic):
        """ğŸ”¥ åˆ›æ–°ï¼šæ™ºèƒ½ä¸Šä¸‹æ–‡æ„å»º"""
        # 1. è·å–çŸ­æœŸè®°å¿†ï¼ˆæœ€è¿‘å¯¹è¯ï¼‰
        recent = self.get_short_term_memory(user_id)

        # 2. æœç´¢ç›¸å…³é•¿æœŸè®°å¿†ï¼ˆåŸºäºå…³é”®è¯ï¼‰
        relevant = self.search_long_term_memory(user_id, keywords)

        # 3. è·å–ç”¨æˆ·ç”»åƒ
        profile = self.get_user_profile(user_id)

        # 4. æ•´åˆä¸Šä¸‹æ–‡
        return {
            "recent_memories": recent,
            "relevant_memories": relevant,
            "profile": profile
        }

# analyst_collaborator.py
async def perform_analysis(self, content, framework_name, user_id):
    # ğŸ”¥ åˆ›æ–°ï¼šä½¿ç”¨è®°å¿†ç³»ç»Ÿæä¾›ä¸Šä¸‹æ–‡
    context_data = memory_palace.build_context(user_id, current_topic=content)

    prompt = f"""
    ç”¨æˆ·å†å²ï¼š
    - æ€»äº’åŠ¨æ¬¡æ•°: {len(context_data['recent_memories'])}
    - ä½¿ç”¨è¿‡çš„æ¡†æ¶: {context_data['profile']['frameworks_used']}
    - ç›¸å…³è®°å¿†: {context_data['relevant_memories']}

    å½“å‰é—®é¢˜: {content}
    """
```

**åˆ›æ–°ç‚¹**ï¼š

- âœ… **åŒå±‚è®°å¿†æ¶æ„**ï¼šçŸ­æœŸè®°å¿†ï¼ˆå¯¹è¯ï¼‰+ é•¿æœŸè®°å¿†ï¼ˆæ´å¯Ÿï¼‰
- âœ… **æ™ºèƒ½æ£€ç´¢**ï¼šåŸºäºå…³é”®è¯å’Œç›¸å…³æ€§æœç´¢å†å²
- âœ… **ç”¨æˆ·ç”»åƒ**ï¼šæŒç»­æ„å»ºå’Œæ›´æ–°ç”¨æˆ·ç‰¹å¾
- âœ… **ä¸Šä¸‹æ–‡å¢å¼º**ï¼šæ¯æ¬¡åˆ†æéƒ½è€ƒè™‘å†å²ä¿¡æ¯

**è®°å¿†ç³»ç»Ÿæ¶æ„**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Memory Palace                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  çŸ­æœŸè®°å¿† (TTL: 1å°æ—¶)               â”‚
â”‚  - æœ€è¿‘å¯¹è¯                          â”‚
â”‚  - ä¸´æ—¶çŠ¶æ€                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é•¿æœŸè®°å¿† (æŒä¹…åŒ–)                   â”‚
â”‚  - å…³é”®æ´å¯Ÿ                          â”‚
â”‚  - é‡è¦æ¨¡å¼                          â”‚
â”‚  - ç”¨æˆ·åå¥½                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç”¨æˆ·ç”»åƒ                            â”‚
â”‚  - ä½¿ç”¨çš„æ¡†æ¶                        â”‚
â”‚  - å…³æ³¨çš„ä¸»é¢˜                        â”‚
â”‚  - æˆé•¿è½¨è¿¹                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4. å¼‚æ­¥åä½œä¸å®¹é”™æœºåˆ¶ â­â­â­â­

#### ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜

```
åŒæ­¥è°ƒç”¨ â†’ é˜»å¡ç­‰å¾… â†’ å•ç‚¹å¤±è´¥
- ä¸€ä¸ªç¯èŠ‚å¤±è´¥ï¼Œå…¨éƒ¨å¤±è´¥
- æ— æ³•å¹¶å‘å¤„ç†
- ç”¨æˆ·ä½“éªŒå·®
```

#### æˆ‘ä»¬çš„åˆ›æ–°ï¼š**å¼‚æ­¥æ¶ˆæ¯ä¼ é€’ + çŠ¶æ€è·Ÿè¸ª**

```python
# coordinator_collaborator.py
class CoordinatorCollaborator(CollaboratorAgent):
    def __init__(self):
        # ğŸ”¥ åˆ›æ–°ï¼šçŠ¶æ€è·Ÿè¸ªç³»ç»Ÿ
        self.pending_analysis = {}  # user_id -> {channel, content}
        self.pending_plans = {}     # user_id -> {channel, insights}

    async def handle_analysis_request(self, user_id, content, channel):
        """å¼‚æ­¥å‘é€è¯·æ±‚ï¼Œä¸é˜»å¡"""
        try:
            # 1. ç«‹å³å‘ŠçŸ¥ç”¨æˆ·
            await ws.channel(channel).post("æ­£åœ¨åˆ†æ... ğŸ”")

            # 2. è®°å½•çŠ¶æ€
            self.pending_analysis[user_id] = {
                "channel": channel,
                "content": content,
                "timestamp": time.time()
            }

            # 3. å¼‚æ­¥å‘é€è¯·æ±‚
            await ws.agent("analyst-agent").send(request)

        except Exception as e:
            # ğŸ”¥ åˆ›æ–°ï¼šä¼˜é›…çš„é”™è¯¯å¤„ç†
            logger.error(f"åˆ†æè¯·æ±‚å¤±è´¥: {e}")
            await ws.channel(channel).post("æŠ±æ­‰ï¼Œé‡åˆ°äº†é—®é¢˜ã€‚è¯·ç¨åå†è¯•ã€‚")
            # æ¸…ç†çŠ¶æ€
            self.pending_analysis.pop(user_id, None)

    async def on_direct(self, msg):
        """å¼‚æ­¥æ¥æ”¶å“åº”"""
        try:
            data = json.loads(msg.text)
            user_id = data.get("user_id")

            # ğŸ”¥ åˆ›æ–°ï¼šéªŒè¯çŠ¶æ€
            if user_id not in self.pending_analysis:
                logger.warning(f"æ”¶åˆ°æœªé¢„æœŸçš„å“åº”: {user_id}")
                return

            # å¤„ç†å“åº”
            await self.handle_analysis_response(data)

        except Exception as e:
            # å®¹é”™å¤„ç†
            logger.error(f"å¤„ç†å“åº”å¤±è´¥: {e}")
```

**åˆ›æ–°ç‚¹**ï¼š

- âœ… **å¼‚æ­¥éé˜»å¡**ï¼šè¯·æ±‚å‘é€åç«‹å³è¿”å›ï¼Œä¸ç­‰å¾…å“åº”
- âœ… **çŠ¶æ€è·Ÿè¸ª**ï¼šä½¿ç”¨å­—å…¸è·Ÿè¸ªæ‰€æœ‰è¿›è¡Œä¸­çš„è¯·æ±‚
- âœ… **è¶…æ—¶å¤„ç†**ï¼šå¯ä»¥æ£€æµ‹å’Œå¤„ç†è¶…æ—¶è¯·æ±‚
- âœ… **ä¼˜é›…é™çº§**ï¼šå•ä¸ª Agent å¤±è´¥ä¸å½±å“æ•´ä½“ç³»ç»Ÿ
- âœ… **ç”¨æˆ·åé¦ˆ**ï¼šæ¯ä¸ªé˜¶æ®µéƒ½æœ‰è¿›åº¦æç¤º

**å®¹é”™æµç¨‹**ï¼š

```
è¯·æ±‚å‘é€
  â†“
ç«‹å³åé¦ˆç”¨æˆ· âœ…
  â†“
è®°å½•çŠ¶æ€ âœ…
  â†“
ç­‰å¾…å“åº”ï¼ˆå¼‚æ­¥ï¼‰
  â†“
æ”¶åˆ°å“åº”ï¼Ÿ
  â”œâ”€ æ˜¯ â†’ éªŒè¯çŠ¶æ€ â†’ å¤„ç† â†’ æ¸…ç†çŠ¶æ€ âœ…
  â””â”€ å¦ â†’ è¶…æ—¶æ£€æµ‹ â†’ é€šçŸ¥ç”¨æˆ· â†’ æ¸…ç†çŠ¶æ€ âœ…
```

---

### 5. ç»“æ„åŒ–è¾“å‡ºä¸ç”¨æˆ·ä½“éªŒ â­â­â­â­

#### ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜

```
AI è¾“å‡º â†’ é•¿ç¯‡æ–‡å­— â†’ éš¾ä»¥é˜…è¯»
- ä¿¡æ¯å¯†é›†
- ç¼ºä¹ç»“æ„
- ä¸æ˜“è¡ŒåŠ¨
```

#### æˆ‘ä»¬çš„åˆ›æ–°ï¼š**åˆ†å±‚ç»“æ„åŒ–è¾“å‡º**

```python
# coordinator_collaborator.py
def _format_complete_response(self, insights, action_plan):
    """ğŸ”¥ åˆ›æ–°ï¼šç»“æ„åŒ–ã€å¯è§†åŒ–çš„è¾“å‡ºæ ¼å¼"""
    response = "ğŸ“Š **åˆ†æå®Œæˆ**\n\n"

    # ç¬¬ä¸€å±‚ï¼šå…³é”®æ´å¯Ÿï¼ˆ3ä¸ªï¼‰
    response += "ğŸ’¡ **å…³é”®æ´å¯Ÿï¼š**\n"
    for i, insight in enumerate(insights[:3], 1):
        response += f"{i}. {insight}\n"

    response += "\n"

    # ç¬¬äºŒå±‚ï¼šè¡ŒåŠ¨è®¡åˆ’
    response += f"ğŸ¯ **{action_plan['title']}**\n\n"
    response += f"ğŸ“ {action_plan['overview']}\n\n"

    # ç¬¬ä¸‰å±‚ï¼šå…·ä½“æ­¥éª¤
    response += "ğŸ“‹ **è¡ŒåŠ¨æ­¥éª¤ï¼š**\n"
    for i, step in enumerate(action_plan['steps'][:5], 1):
        response += f"\n{i}. {step['action']}"
        if step['timeline']:
            response += f" ({step['timeline']})"
        if step['benefit']:
            response += f"\n   ğŸ’¡ {step['benefit']}"

    # ç¬¬å››å±‚ï¼šé¼“åŠ±å’Œæ”¯æŒ
    response += "\n\nğŸŒŸ å¼€å§‹è¡ŒåŠ¨å§ï¼å¦‚æœéœ€è¦è°ƒæ•´æˆ–æœ‰ä»»ä½•é—®é¢˜ï¼Œéšæ—¶å‘Šè¯‰æˆ‘ã€‚"

    return response
```

**åˆ›æ–°ç‚¹**ï¼š

- âœ… **ä¿¡æ¯åˆ†å±‚**ï¼šæ´å¯Ÿ â†’ è®¡åˆ’ â†’ æ­¥éª¤ â†’ é¼“åŠ±
- âœ… **è§†è§‰å¼•å¯¼**ï¼šä½¿ç”¨ emoji å’Œæ ¼å¼åŒ–å¢å¼ºå¯è¯»æ€§
- âœ… **å¯æ“ä½œæ€§**ï¼šæ¯ä¸ªæ­¥éª¤éƒ½æœ‰æ—¶é—´æ¡†æ¶å’Œé¢„æœŸæ•ˆæœ
- âœ… **æƒ…æ„Ÿæ”¯æŒ**ï¼šä¸ä»…æä¾›æ–¹æ¡ˆï¼Œè¿˜æä¾›é¼“åŠ±

**è¾“å‡ºç¤ºä¾‹**ï¼š

```
ğŸ“Š **åˆ†æå®Œæˆ**

ğŸ’¡ **å…³é”®æ´å¯Ÿï¼š**
1. å·¥ä½œå‹åŠ›ä¸»è¦æ¥æºäºä»»åŠ¡è¿‡è½½å’Œæ—¶é—´ç®¡ç†ä¸å½“
2. éœ€è¦å»ºç«‹æ›´æ¸…æ™°çš„å·¥ä½œè¾¹ç•Œå’Œä¼˜å…ˆçº§ç³»ç»Ÿ
3. ç¼ºä¹æœ‰æ•ˆçš„å‹åŠ›é‡Šæ”¾æœºåˆ¶

ğŸ¯ **å·¥ä½œå‹åŠ›ç®¡ç†è¡ŒåŠ¨è®¡åˆ’**

ğŸ“ é€šè¿‡æ”¹å–„æ—¶é—´ç®¡ç†å’Œå»ºç«‹å¥åº·è¾¹ç•Œï¼Œé€æ­¥å‡è½»å·¥ä½œå‹åŠ›ï¼Œæå‡å·¥ä½œæ•ˆç‡å’Œç”Ÿæ´»è´¨é‡ã€‚

ğŸ“‹ **è¡ŒåŠ¨æ­¥éª¤ï¼š**

1. æ¯å¤©æ—©æ™¨åˆ—å‡º3ä¸ªæœ€é‡è¦ä»»åŠ¡ (æœ¬å‘¨å¼€å§‹)
   ğŸ’¡ å¸®åŠ©èšç„¦é‡ç‚¹ï¼Œé¿å…è¢«çäº‹æ·¹æ²¡

2. è®¾ç½®å·¥ä½œæ—¶é—´è¾¹ç•Œï¼Œæ™šä¸Š8ç‚¹åä¸æŸ¥çœ‹å·¥ä½œé‚®ä»¶ (ç«‹å³æ‰§è¡Œ)
   ğŸ’¡ ä¿æŠ¤ä¸ªäººæ—¶é—´ï¼Œæ”¹å–„å·¥ä½œç”Ÿæ´»å¹³è¡¡

3. æ¯å¤©å®‰æ’15åˆ†é’Ÿå†¥æƒ³æˆ–æ•£æ­¥ (æ¯æ—¥)
   ğŸ’¡ æœ‰æ•ˆé‡Šæ”¾å‹åŠ›ï¼Œæå‡ä¸“æ³¨åŠ›

ğŸŒŸ å¼€å§‹è¡ŒåŠ¨å§ï¼å¦‚æœéœ€è¦è°ƒæ•´æˆ–æœ‰ä»»ä½•é—®é¢˜ï¼Œéšæ—¶å‘Šè¯‰æˆ‘ã€‚
```

---

### 6. API ä¼˜åŒ–ä¸æˆæœ¬æ§åˆ¶ â­â­â­â­

#### ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜

```
æ¯æ¡æ¶ˆæ¯ â†’ è°ƒç”¨ API â†’ æˆæœ¬é«˜æ˜‚
- é‡å¤è°ƒç”¨
- æ— èŠ‚æµ
- æµªè´¹èµ„æº
```

#### æˆ‘ä»¬çš„åˆ›æ–°ï¼š**å¤šå±‚ä¼˜åŒ–ç­–ç•¥**

```python
# daily_assistant_listener.py (æ—©æœŸç‰ˆæœ¬)
class DailyAssistantListener(WorkerAgent):
    def __init__(self):
        # ğŸ”¥ åˆ›æ–°1ï¼šæ¶ˆæ¯å»é‡
        self.processed_messages = set()
        self.cache_size = 100

        # ğŸ”¥ åˆ›æ–°2ï¼šåˆ†æå†·å´
        self.last_analysis = {}  # user_id -> timestamp
        self.analysis_cooldown = 300  # 5åˆ†é’Ÿ

    async def react(self, ctx):
        # åˆ›æ–°1ï¼šè·³è¿‡å·²å¤„ç†çš„æ¶ˆæ¯
        msg_id = ctx.incoming_event.payload.get("original_event_id")
        if msg_id in self.processed_messages:
            return

        # åˆ›æ–°2ï¼šè·³è¿‡ Agent è‡ªå·±çš„æ¶ˆæ¯
        if source_id == self.agent_id or source_id.endswith("-agent"):
            return

        # åˆ›æ–°3ï¼šæ£€æŸ¥å†·å´æ—¶é—´
        if user_id in self.last_analysis:
            elapsed = (datetime.now() - self.last_analysis[user_id]).total_seconds()
            if elapsed < self.analysis_cooldown:
                print(f"åˆ†æå†·å´ä¸­ï¼Œè·³è¿‡ (å‰©ä½™ {int(self.analysis_cooldown - elapsed)}ç§’)")
                return

        # åˆ›æ–°4ï¼šå‡å°‘ token ä½¿ç”¨
        # max_tokens: 150 â†’ 100 (ç®€å•å¯¹è¯)
        # max_tokens: 800 (åˆ†æ)
        # max_tokens: 600 (åˆ›ä½œ)
```

**åˆ›æ–°ç‚¹**ï¼š

- âœ… **æ¶ˆæ¯å»é‡**ï¼šé¿å…é‡å¤å¤„ç†åŒä¸€æ¶ˆæ¯
- âœ… **æ™ºèƒ½è¿‡æ»¤**ï¼šè·³è¿‡ Agent è‡ªå·±çš„æ¶ˆæ¯
- âœ… **å†·å´æœºåˆ¶**ï¼šé™åˆ¶åŒä¸€ç”¨æˆ·çš„åˆ†æé¢‘ç‡
- âœ… **Token ä¼˜åŒ–**ï¼šæ ¹æ®ä»»åŠ¡ç±»å‹è°ƒæ•´ token æ•°é‡
- âœ… **æ¨¡å‹é€‰æ‹©**ï¼šç®€å•ä»»åŠ¡ç”¨å°æ¨¡å‹ï¼Œå¤æ‚ä»»åŠ¡ç”¨å¤§æ¨¡å‹

**æˆæœ¬å¯¹æ¯”**ï¼š
| ä¼˜åŒ–å‰ | ä¼˜åŒ–å | èŠ‚çœ |
|--------|--------|------|
| ~400 API è°ƒç”¨/å¤© | ~150 API è°ƒç”¨/å¤© | 62.5% |
| æ¯æ¬¡ 150 tokens | æ¯æ¬¡ 100 tokens | 33% |
| æ€»æˆæœ¬: $X | æ€»æˆæœ¬: $0.25X | 75% |

---

### 7. æ¨¡å—åŒ–ä¸å¯æ‰©å±•æ€§ â­â­â­â­â­

#### ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜

```
å•ä½“ç³»ç»Ÿ â†’ éš¾ä»¥æ‰©å±• â†’ ç»´æŠ¤å›°éš¾
- è€¦åˆåº¦é«˜
- éš¾ä»¥æµ‹è¯•
- æ— æ³•ç‹¬ç«‹å‡çº§
```

#### æˆ‘ä»¬çš„åˆ›æ–°ï¼š**æ¾è€¦åˆçš„æ¨¡å—åŒ–æ¶æ„**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Agent Layer                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚Coordinatorâ”‚  â”‚ Analyst  â”‚  â”‚ Creator  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       â”‚    Communication Layer    â”‚                    â”‚
â”‚       â”‚   (Messaging Mod)          â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       â”‚      Storage Layer         â”‚                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  Simple  â”‚  â”‚ Memory  â”‚  â”‚Framework â”‚             â”‚
â”‚  â”‚ Storage  â”‚  â”‚ Palace  â”‚  â”‚ Library  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åˆ›æ–°ç‚¹**ï¼š

- âœ… **Agent ç‹¬ç«‹æ€§**ï¼šæ¯ä¸ª Agent å¯ä»¥ç‹¬ç«‹å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²
- âœ… **å­˜å‚¨æŠ½è±¡**ï¼šç»Ÿä¸€çš„å­˜å‚¨æ¥å£ï¼Œæ˜“äºåˆ‡æ¢æ•°æ®åº“
- âœ… **æ¡†æ¶å¯æ’æ‹”**ï¼šè½»æ¾æ·»åŠ æ–°çš„åˆ†ææ¡†æ¶
- âœ… **é€šä¿¡è§£è€¦**ï¼šé€šè¿‡ messaging mod è§£è€¦ Agent é—´ä¾èµ–

**æ‰©å±•ç¤ºä¾‹**ï¼š

```python
# æ·»åŠ æ–°çš„ Agent åªéœ€3æ­¥

# 1. åˆ›å»ºæ–° Agent
class EmotionAgent(CollaboratorAgent):
    async def on_direct(self, msg):
        # æƒ…ç»ªåˆ†æé€»è¾‘
        pass

# 2. åœ¨ Coordinator ä¸­æ·»åŠ è·¯ç”±
if self._needs_emotion_analysis(content):
    await ws.agent("emotion-agent").send(request)

# 3. å¯åŠ¨æ–° Agent
python3 agents/emotion_agent.py
```

---

## ğŸ“Š åˆ›æ–°ç‚¹æ€»ç»“å¯¹æ¯”

| åˆ›æ–°ç‚¹       | ä¼ ç»Ÿæ–¹å¼ | æˆ‘ä»¬çš„åˆ›æ–°      | ä¼˜åŠ¿             |
| ------------ | -------- | --------------- | ---------------- |
| **ä»»åŠ¡åˆ†é…** | å›ºå®šè§„åˆ™ | æ™ºèƒ½è¯­ä¹‰åˆ†æ    | åŠ¨æ€ã€é«˜æ•ˆ       |
| **ä¸“ä¸šæ€§**   | é€šç”¨å»ºè®® | æ¡†æ¶é©±åŠ¨åˆ†æ    | ç†è®ºæ”¯æ’‘ã€ä¸“ä¸š   |
| **è®°å¿†ç³»ç»Ÿ** | æ— çŠ¶æ€   | åŒå±‚è®°å¿†        | è¿ç»­æ€§ã€ä¸ªæ€§åŒ–   |
| **å®¹é”™æœºåˆ¶** | åŒæ­¥é˜»å¡ | å¼‚æ­¥ + çŠ¶æ€è·Ÿè¸ª | å¯é ã€ç”¨æˆ·ä½“éªŒå¥½ |
| **è¾“å‡ºæ ¼å¼** | çº¯æ–‡æœ¬   | ç»“æ„åŒ– + å¯è§†åŒ– | æ˜“è¯»ã€å¯æ“ä½œ     |
| **æˆæœ¬æ§åˆ¶** | æ— ä¼˜åŒ–   | å¤šå±‚ä¼˜åŒ–        | èŠ‚çœ 75%æˆæœ¬     |
| **å¯æ‰©å±•æ€§** | å•ä½“     | æ¨¡å—åŒ–          | æ˜“ç»´æŠ¤ã€æ˜“æ‰©å±•   |

---

## ğŸ¯ å®é™…åº”ç”¨ä»·å€¼

### å¯¹ç”¨æˆ·çš„ä»·å€¼

1. **æ›´ä¸“ä¸šçš„åˆ†æ**ï¼šåŸºäºå¿ƒç†å­¦æ¡†æ¶ï¼Œä¸æ˜¯éšæ„å»ºè®®
2. **æ›´ä¸ªæ€§åŒ–çš„æ–¹æ¡ˆ**ï¼šè€ƒè™‘å†å²å’Œä¸Šä¸‹æ–‡
3. **æ›´æ¸…æ™°çš„æŒ‡å¯¼**ï¼šç»“æ„åŒ–è¾“å‡ºï¼Œæ˜“äºç†è§£å’Œæ‰§è¡Œ
4. **æ›´å¥½çš„ä½“éªŒ**ï¼šå¿«é€Ÿå“åº”ï¼Œè¿›åº¦åé¦ˆ

### å¯¹å¼€å‘è€…çš„ä»·å€¼

1. **æ˜“äºç»´æŠ¤**ï¼šæ¨¡å—åŒ–æ¶æ„ï¼ŒèŒè´£æ¸…æ™°
2. **æ˜“äºæ‰©å±•**ï¼šæ·»åŠ æ–°åŠŸèƒ½ä¸å½±å“ç°æœ‰ç³»ç»Ÿ
3. **æ˜“äºæµ‹è¯•**ï¼šæ¯ä¸ª Agent å¯ä»¥ç‹¬ç«‹æµ‹è¯•
4. **æˆæœ¬å¯æ§**ï¼šå¤šå±‚ä¼˜åŒ–ï¼Œé™ä½è¿è¥æˆæœ¬

### å¯¹è¡Œä¸šçš„ä»·å€¼

1. **å¯å¤åˆ¶çš„æ¨¡å¼**ï¼šé€‚ç”¨äºå…¶ä»–é¢†åŸŸçš„ AI åŠ©æ‰‹
2. **æœ€ä½³å®è·µ**ï¼šå±•ç¤ºäº†å¤š Agent åä½œçš„æœ‰æ•ˆæ–¹å¼
3. **å¼€æºæ½œåŠ›**ï¼šæ¶æ„æ¸…æ™°ï¼Œæ˜“äºå­¦ä¹ å’Œæ”¹è¿›

---

## ğŸ”® æœªæ¥åˆ›æ–°æ–¹å‘

### 1. è‡ªé€‚åº”å­¦ä¹ 

```python
# Agent æ ¹æ®ç”¨æˆ·åé¦ˆè‡ªåŠ¨è°ƒæ•´ç­–ç•¥
class AdaptiveCoordinator(CollaboratorAgent):
    async def learn_from_feedback(self, user_id, feedback):
        # è°ƒæ•´æ¡†æ¶é€‰æ‹©æƒé‡
        # ä¼˜åŒ–åˆ†ææ·±åº¦
        # ä¸ªæ€§åŒ–è¾“å‡ºæ ¼å¼
```

### 2. å¤šæ¨¡æ€æ”¯æŒ

```python
# æ”¯æŒè¯­éŸ³ã€å›¾ç‰‡ã€è§†é¢‘è¾“å…¥
async def on_file_upload(self, msg):
    if msg.file_type == "audio":
        text = await self.speech_to_text(msg)
    elif msg.file_type == "image":
        analysis = await self.image_analysis(msg)
```

### 3. ä¸»åŠ¨å¼æœåŠ¡

```python
# Agent ä¸»åŠ¨å‘ç°é—®é¢˜å¹¶æä¾›å¸®åŠ©
async def proactive_check(self):
    # åˆ†æç”¨æˆ·æ¨¡å¼
    # é¢„æµ‹æ½œåœ¨é—®é¢˜
    # ä¸»åŠ¨æä¾›å»ºè®®
```

### 4. ç¤¾åŒºåä½œ

```python
# ç”¨æˆ·ä¹‹é—´äº’ç›¸å¸®åŠ©
async def create_support_group(self, topic):
    # åŒ¹é…ç›¸ä¼¼ç»å†çš„ç”¨æˆ·
    # åˆ›å»ºè®¨è®ºç»„
    # Agent ä½œä¸ºå¼•å¯¼è€…
```

---

## ğŸ’¡ æ€»ç»“

Symphony MVP çš„åˆ›æ–°ä¸åœ¨äºä½¿ç”¨äº†å¤šä¹ˆå¤æ‚çš„æŠ€æœ¯ï¼Œè€Œåœ¨äºï¼š

1. **æ™ºèƒ½åŒ–**ï¼šè®© AI åšå†³ç­–ï¼Œè€Œä¸æ˜¯ç¡¬ç¼–ç è§„åˆ™
2. **ä¸“ä¸šåŒ–**ï¼šåŸºäºç†è®ºæ¡†æ¶ï¼Œæä¾›ä¸“ä¸šå»ºè®®
3. **äººæ€§åŒ–**ï¼šå…³æ³¨ç”¨æˆ·ä½“éªŒçš„æ¯ä¸ªç»†èŠ‚
4. **å·¥ç¨‹åŒ–**ï¼šæ³¨é‡æˆæœ¬ã€æ€§èƒ½ã€å¯ç»´æŠ¤æ€§

è¿™äº›åˆ›æ–°ç‚¹å…±åŒæ„æˆäº†ä¸€ä¸ª**çœŸæ­£æœ‰ç”¨ã€å¯æŒç»­ã€å¯æ‰©å±•**çš„ä¸ªäººæˆé•¿ AI åŠ©æ‰‹ç³»ç»Ÿã€‚
