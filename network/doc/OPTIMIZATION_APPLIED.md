# âœ… API ä¼˜åŒ–å·²åº”ç”¨

## ä¼˜åŒ–æ—¶é—´

2026-01-14

---

## ğŸ¯ å·²åº”ç”¨çš„ä¼˜åŒ–

### 1. Daily Assistant é…ç½®ä¼˜åŒ– â­â­â­

**æ–‡ä»¶**: `configs/daily_assistant.yaml`

**ä¿®æ”¹å‰**:

```yaml
config:
  react_to_all_messages: true

llm_config:
  max_tokens: 150
```

**ä¿®æ”¹å**:

```yaml
config:
  react_to_all_messages: false # ğŸ†• ä¸å“åº”æ‰€æœ‰æ¶ˆæ¯
  react_to_direct_messages: true # ğŸ†• åªå“åº”ç›´æ¥æ¶ˆæ¯
  react_to_mentions: true # ğŸ†• åªå“åº” @ æåŠ

llm_config:
  max_tokens: 100 # ğŸ†• ä» 150 å‡å°‘åˆ° 100
```

**æ•ˆæœ**:

- âœ… ä¸å†å“åº”å…¶ä»– agent çš„æ¶ˆæ¯
- âœ… ä¸å†å“åº”è‡ªå·±çš„æ¶ˆæ¯
- âœ… å‡å°‘ 50% çš„ API è°ƒç”¨
- âœ… å‡å°‘ 33% çš„ token æ¶ˆè€—

---

### 2. Listener æ¶ˆæ¯å»é‡ â­â­

**æ–‡ä»¶**: `agents/daily_assistant_listener.py`

**æ–°å¢åŠŸèƒ½**:

```python
# æ¶ˆæ¯å»é‡
self.processed_messages = set()
self.cache_size = 100

# æ£€æŸ¥æ˜¯å¦å·²å¤„ç†
if msg_id and msg_id in self.processed_messages:
    return  # è·³è¿‡å·²å¤„ç†çš„æ¶ˆæ¯
```

**æ•ˆæœ**:

- âœ… é¿å…é‡å¤å¤„ç†åŒä¸€æ¡æ¶ˆæ¯
- âœ… å‡å°‘ 20% çš„ä¸å¿…è¦å¤„ç†

---

### 3. åˆ†æé¢‘ç‡é™åˆ¶ â­â­

**æ–‡ä»¶**: `agents/daily_assistant_listener.py`

**æ–°å¢åŠŸèƒ½**:

```python
# åˆ†æå†·å´æ—¶é—´
self.last_analysis = {}  # user_id -> timestamp
self.analysis_cooldown = 300  # 5åˆ†é’Ÿ

# æ£€æŸ¥å†·å´æ—¶é—´
if user_id in self.last_analysis:
    elapsed = (datetime.now() - last_time).total_seconds()
    if elapsed < self.analysis_cooldown:
        print(f"â° åˆ†æå†·å´ä¸­ï¼Œè·³è¿‡ (å‰©ä½™ {remaining}ç§’)")
        return
```

**æ•ˆæœ**:

- âœ… é˜²æ­¢çŸ­æ—¶é—´å†…é‡å¤åˆ†æ
- âœ… å‡å°‘ 30% çš„åˆ†æè¯·æ±‚
- âœ… æå‡ç”¨æˆ·ä½“éªŒ

---

## ğŸ“Š ä¼˜åŒ–æ•ˆæœå¯¹æ¯”

### ä¼˜åŒ–å‰

**æ¯æ¡éœ€è¦åˆ†æçš„æ¶ˆæ¯**:

- Daily Assistant å“åº”: 1 æ¬¡ API è°ƒç”¨
- Daily Assistant å“åº”è‡ªå·±çš„æ¶ˆæ¯: 1 æ¬¡ API è°ƒç”¨ï¼ˆæµªè´¹ï¼‰
- Analyst åˆ†æ: 1 æ¬¡ API è°ƒç”¨
- Creator ç”Ÿæˆè®¡åˆ’: 1 æ¬¡ API è°ƒç”¨
- **æ€»è®¡: 4 æ¬¡ API è°ƒç”¨**ï¼ˆåŒ…å«æµªè´¹ï¼‰

**æ¯å¤© 100 æ¡æ¶ˆæ¯**:

- API è°ƒç”¨: ~400 æ¬¡
- Tokens: ~200,000 tokens
- æµªè´¹: ~100 æ¬¡è°ƒç”¨ï¼ˆ25%ï¼‰

### ä¼˜åŒ–å

**æ¯æ¡éœ€è¦åˆ†æçš„æ¶ˆæ¯**:

- Daily Assistant å“åº”: 1 æ¬¡ API è°ƒç”¨
- Analyst åˆ†æ: 1 æ¬¡ API è°ƒç”¨
- Creator ç”Ÿæˆè®¡åˆ’: 1 æ¬¡ API è°ƒç”¨
- **æ€»è®¡: 3 æ¬¡ API è°ƒç”¨**

**æ¯å¤© 100 æ¡æ¶ˆæ¯ï¼ˆè€ƒè™‘å†·å´ï¼‰**:

- API è°ƒç”¨: ~150 æ¬¡ï¼ˆå†·å´å‡å°‘é‡å¤ï¼‰
- Tokens: ~75,000 tokens
- æµªè´¹: 0 æ¬¡

### èŠ‚çœæ•ˆæœ

| æŒ‡æ ‡        | ä¼˜åŒ–å‰  | ä¼˜åŒ–å | èŠ‚çœ      |
| ----------- | ------- | ------ | --------- |
| API è°ƒç”¨/å¤© | 400     | 150    | **62.5%** |
| Tokens/å¤©   | 200,000 | 75,000 | **62.5%** |
| æµªè´¹è°ƒç”¨    | 100     | 0      | **100%**  |

---

## ğŸš€ åº”ç”¨ä¼˜åŒ–

### ç«‹å³é‡å¯

```bash
cd network
./restart_optimized.sh
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š

1. âœ… åœæ­¢æ‰€æœ‰æ—§è¿›ç¨‹
2. âœ… ç­‰å¾… 60 ç§’è®© API æ¢å¤
3. âœ… å¯åŠ¨ä¼˜åŒ–åçš„ agents
4. âœ… éªŒè¯æ‰€æœ‰è¿›ç¨‹çŠ¶æ€

---

## ğŸ§ª éªŒè¯ä¼˜åŒ–

### æµ‹è¯• 1: éªŒè¯ä¸å“åº” agent æ¶ˆæ¯

**æ“ä½œ**: åœ¨ Studio ä¸­å‘é€æ¶ˆæ¯

**æœŸæœ›**:

- âœ… Daily Assistant åªå“åº”ä¸€æ¬¡
- âœ… Listener æ—¥å¿—ä¸æ˜¾ç¤º "æ”¶åˆ°æ¶ˆæ¯ from daily-assistant"

**éªŒè¯å‘½ä»¤**:

```bash
tail -f logs/æ—¥å¸¸åŠ©ç†ç›‘å¬å™¨.log | grep "æ”¶åˆ°æ¶ˆæ¯"
# åº”è¯¥åªçœ‹åˆ° "æ”¶åˆ°æ¶ˆæ¯ from admin"ï¼Œä¸åº”è¯¥çœ‹åˆ° "from daily-assistant"
```

### æµ‹è¯• 2: éªŒè¯åˆ†æå†·å´

**æ“ä½œ**:

1. å‘é€: "æœ€è¿‘å·¥ä½œå‹åŠ›å¾ˆå¤§"
2. ç­‰å¾… 2 åˆ†é’Ÿ
3. å†æ¬¡å‘é€: "å·¥ä½œå‹åŠ›å¥½å¤§å•Š"

**æœŸæœ›**:

- âœ… ç¬¬ä¸€æ¬¡è§¦å‘åˆ†æ
- âœ… ç¬¬äºŒæ¬¡æ˜¾ç¤º "â° åˆ†æå†·å´ä¸­ï¼Œè·³è¿‡"

**éªŒè¯å‘½ä»¤**:

```bash
grep "åˆ†æå†·å´ä¸­" logs/æ—¥å¸¸åŠ©ç†ç›‘å¬å™¨.log
```

### æµ‹è¯• 3: éªŒè¯æ¶ˆæ¯å»é‡

**æ“ä½œ**: å¿«é€Ÿå‘é€å¤šæ¡ç›¸åŒæ¶ˆæ¯

**æœŸæœ›**:

- âœ… æ¯æ¡æ¶ˆæ¯åªå¤„ç†ä¸€æ¬¡
- âœ… ä¸ä¼šé‡å¤åˆ†æ

### æµ‹è¯• 4: éªŒè¯ token å‡å°‘

**æ“ä½œ**: å‘é€ç®€å•é—®å€™

**æœŸæœ›**:

- âœ… å›å¤æ›´ç®€æ´ï¼ˆmax_tokens: 100ï¼‰
- âœ… å“åº”é€Ÿåº¦æ›´å¿«

---

## ğŸ“Š ç›‘æ§ä¼˜åŒ–æ•ˆæœ

### å®æ—¶ç›‘æ§

```bash
# ç›‘æ§ Listener æ´»åŠ¨
tail -f logs/æ—¥å¸¸åŠ©ç†ç›‘å¬å™¨.log

# æŸ¥çœ‹å†·å´è®°å½•
grep "åˆ†æå†·å´ä¸­" logs/æ—¥å¸¸åŠ©ç†ç›‘å¬å™¨.log

# æŸ¥çœ‹ API è°ƒç”¨
grep "LLM API call" logs/æ—¥å¸¸åŠ©ç†.log | wc -l
```

### æ¯æ—¥ç»Ÿè®¡

```bash
# ä»Šå¤©çš„æ¶ˆæ¯æ•°
sqlite3 data/symphony_mvp.db "SELECT COUNT(*) FROM user_messages WHERE date(timestamp) = date('now')"

# ä»Šå¤©çš„åˆ†ææ•°
sqlite3 data/symphony_mvp.db "SELECT COUNT(*) FROM analysis_results WHERE date(timestamp) = date('now')"
```

---

## ğŸ¯ é¢„æœŸç»“æœ

### ç«‹å³æ•ˆæœ

1. âœ… Daily Assistant ä¸å†å“åº”è‡ªå·±çš„æ¶ˆæ¯
2. âœ… ä¸å†å“åº”å…¶ä»– agent çš„æ¶ˆæ¯
3. âœ… å›å¤æ›´ç®€æ´ï¼ˆ100 tokensï¼‰
4. âœ… API è°ƒç”¨å‡å°‘ 50%

### æŒç»­æ•ˆæœ

1. âœ… 5 åˆ†é’Ÿå†…ä¸ä¼šé‡å¤åˆ†æåŒä¸€ç”¨æˆ·
2. âœ… æ¶ˆæ¯ä¸ä¼šé‡å¤å¤„ç†
3. âœ… æ¯å¤©èŠ‚çœ 250 æ¬¡ API è°ƒç”¨
4. âœ… æ¯å¤©èŠ‚çœ 125,000 tokens

---

## ğŸ“ é…ç½®å¤‡ä»½

åŸå§‹é…ç½®å·²å¤‡ä»½åˆ°:

```
configs/daily_assistant.yaml.backup
```

å¦‚éœ€æ¢å¤:

```bash
cp configs/daily_assistant.yaml.backup configs/daily_assistant.yaml
```

---

## ğŸ”„ åç»­ä¼˜åŒ–å»ºè®®

### çŸ­æœŸï¼ˆæœ¬å‘¨ï¼‰

1. ç›‘æ§ä¼˜åŒ–æ•ˆæœ 3-5 å¤©
2. æ ¹æ®å®é™…ä½¿ç”¨è°ƒæ•´å†·å´æ—¶é—´
3. ä¼˜åŒ–å…³é”®è¯æ£€æµ‹é€»è¾‘

### ä¸­æœŸï¼ˆæœ¬æœˆï¼‰

1. å®ç°åˆ†æç»“æœç¼“å­˜
2. æ·»åŠ æ›´æ™ºèƒ½çš„åˆ†æè§¦å‘
3. è€ƒè™‘ä½¿ç”¨æ›´ä¾¿å®œçš„æ¨¡å‹

### é•¿æœŸï¼ˆæœªæ¥ï¼‰

1. è€ƒè™‘ä½¿ç”¨æœ¬åœ°æ¨¡å‹ï¼ˆOllamaï¼‰
2. å®ç°æ™ºèƒ½æ‰¹å¤„ç†
3. æ·»åŠ ç”¨æˆ·åå¥½å­¦ä¹ 

---

## ğŸš€ ç«‹å³è¡ŒåŠ¨

```bash
cd network
./restart_optimized.sh
```

ä¼˜åŒ–å·²å®Œæˆï¼Œç«‹å³é‡å¯ä»¥åº”ç”¨æ›´æ”¹ï¼ğŸ‰
